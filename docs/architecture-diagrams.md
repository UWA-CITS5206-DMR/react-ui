# MediSimv1 架构图文档
## Architecture Diagrams Documentation

---

## 📋 文档概述

本文档包含了MediSimv1数字医疗记录仿真平台的完整架构图，使用PlantUML绘制，展示了从MVP架构到生产部署的完整技术架构。

---

## 🎨 架构图总览

### 已创建的架构图

| 架构图名称 | 文件路径 | 描述 | 状态 |
|-----------|---------|------|------|
| **MVP架构图** | [mvp-architecture.puml](./mvp-architecture.puml) | 核心MVP功能架构，展示主要组件和交互 | ✅ 已完成 |
| **系统架构图** | [system-architecture.puml](./system-architecture.puml) | 详细的系统架构，包含所有技术组件 | ✅ 已完成 |
| **部署架构图** | [deployment-architecture.puml](./deployment-architecture.puml) | 生产环境部署架构，包含运维和监控 | ✅ 已完成 |
| **UI可视化图** | [ui-visualization.puml](./ui-visualization.puml) | 用户界面组件结构和页面布局可视化 | ✅ 已完成 |
| **页面布局图** | [page-layouts.puml](./page-layouts.puml) | 详细的页面布局设计和响应式适配 | ✅ 已完成 |
| **UI交互流程图** | [ui-interaction-flow.puml](./ui-interaction-flow.puml) | 用户界面交互流程和操作路径 | ✅ 已完成 |
| **UI组件关系图** | [ui-component-relationships.puml](./ui-component-relationships.puml) | 组件依赖和继承关系结构图 | ✅ 已完成 |
| **Mermaid UI图表** | [ui-mermaid-diagrams.md](./ui-mermaid-diagrams.md) | Mermaid语法的UI可视化图表集合 | ✅ 已完成 |

---

## 🏗️ MVP架构图详解

### 核心组件

#### 用户角色系统
- **系统管理员 (Admin)**: 用户管理、组管理、系统配置
- **仿真协调员 (Coordinator)**: 文档管理、发布调度、活动监控
- **教师 (Instructor)**: 场景控制、学生监控、评估反馈
- **学生 (Student)**: 患者评估、临床决策、文档记录

#### 前端架构
- **React 18 + TypeScript**: 类型安全的前端框架
- **Wouter路由**: 轻量级客户端路由系统
- **shadcn/ui组件库**: 预构建的医疗UI组件
- **Tailwind CSS**: 原子化CSS样式系统

#### 后端架构
- **Node.js + Express**: 高性能后端服务
- **多层中间件**: 认证、权限、数据隔离
- **业务逻辑服务**: 用户、患者、组、文档、审计服务

#### 数据架构
- **PostgreSQL**: 主数据库，支持ACID事务
- **Drizzle ORM**: 类型安全的数据库操作
- **数据隔离**: 组级数据访问控制

### 关键特性

✅ **四角色权限系统**: 完整的RBAC权限控制  
✅ **患者数据管理**: 完整的患者生命周期管理  
✅ **SOAP笔记系统**: 临床记录和评估系统  
✅ **医嘱管理系统**: 医疗指令和药物管理  
✅ **组级数据隔离**: 多租户数据安全  
✅ **基础安全防护**: 多层安全架构  

---

## 🔧 系统架构图详解

### 分层架构设计

#### 1. 用户界面层
- 四角色用户界面
- 响应式设计支持
- 可访问性设计

#### 2. 前端应用层
- **认证模块**: AuthProvider, useAuth Hook, 登录页面
- **路由模块**: Wouter路由, 路由守卫
- **仪表板模块**: 各角色专用仪表板
- **核心功能模块**: 患者管理、SOAP笔记、医嘱管理
- **共享组件**: UI组件库、表单、数据表格、通知
- **状态管理**: React Query、Context API、本地存储

#### 3. API网关层
- **Express服务器**: 主服务器入口
- **中间件栈**: CORS、JSON解析、会话、日志、错误处理
- **安全中间件**: HTTPS强制、速率限制、安全头、CSRF保护

#### 4. 业务逻辑层
- **认证服务**: 认证控制器、密码哈希、JWT生成器、会话管理
- **用户服务**: 用户控制器、权限验证器、角色管理器
- **患者服务**: 患者控制器、生命体征、实验室结果、医疗历史
- **临床服务**: SOAP笔记、医嘱、临床决策支持
- **组管理服务**: 组控制器、数据分配、权限隔离
- **文档服务**: 文档控制器、文件上传、版本控制
- **审计服务**: 审计控制器、活动记录、安全监控

#### 5. 数据访问层
- **ORM层**: Drizzle ORM、查询构建器、迁移管理
- **数据库连接**: 连接池、事务管理、查询优化
- **缓存层**: 内存缓存、查询缓存、会话缓存

#### 6. 数据存储层
- **用户数据**: 用户表、会话表、权限表
- **患者数据**: 患者表、生命体征、实验室结果、医疗历史、用药记录
- **临床数据**: SOAP笔记、医嘱、护理记录、评估记录
- **组织数据**: 组表、组成员、数据分配、数据版本
- **文档数据**: 文档表、版本表、发布表
- **审计数据**: 审计日志、安全事件、访问日志

### 数据流设计

#### API请求流程
1. **中间件处理**: CORS、解析、会话、日志
2. **安全验证**: HTTPS、速率限制、安全头
3. **路由分发**: 到对应控制器
4. **业务逻辑**: 业务规则处理
5. **数据访问**: 数据库操作和缓存
6. **响应返回**: 数据返回和日志记录

#### 数据隔离机制
- 基于用户角色的数据访问控制
- 组级数据边界管理
- 实时权限验证和审计
- 防止越权访问和数据泄露

---

## 🚀 部署架构图详解

### 生产环境架构

#### 1. 内容分发和负载均衡
- **Cloudflare CDN**: 全球边缘节点、DDoS防护、SSL/TLS终止
- **负载均衡器**: Nginx负载均衡、健康检查、会话保持

#### 2. 应用服务器层
- **主应用服务器**: Node.js进程、Express应用、PM2进程管理
- **静态资源服务器**: Vite构建产物、React应用、静态文件服务
- **高可用设计**: 多实例部署、自动故障切换

#### 3. 缓存层
- **Redis集群**: 主从复制、哨兵自动故障检测
- **分布式缓存**: 支持水平扩展、数据持久化

#### 4. 数据库层
- **Neon PostgreSQL**: 云原生数据库、主从读写分离
- **连接池优化**: 自动备份恢复、云原生扩展

#### 5. 文件存储层
- **Google Cloud Storage**: 医疗文档、用户上传、系统备份
- **CDN集成**: 全球文件分发、缓存优化

#### 6. 监控和运维层
- **监控平台**: Prometheus、Grafana、告警管理、指标收集
- **日志管理**: ELK Stack、日志聚合、分析、存储
- **健康检查**: 实时监控、性能监控

#### 7. 安全架构层
- **安全服务**: WAF防火墙、DDoS防护、入侵检测、安全扫描
- **加密传输**: HTTPS/TLS证书、密钥管理、审计日志

#### 8. 外部服务集成
- **邮件服务**: SMTP服务器、邮件队列、模板
- **短信服务**: SMS网关、短信队列、模板
- **第三方认证**: OAuth提供商、SSO集成、多因素认证

### 部署策略

#### 高可用设计
- 多实例应用服务器
- 主从数据库架构
- Redis集群高可用
- 自动故障检测和切换

#### 扩展性设计
- 水平扩展支持
- 负载均衡分发
- 缓存层优化
- 云原生架构

#### 安全防护
- 多层安全防护
- WAF和DDoS防护
- 入侵检测系统
- 实时安全监控

---

## 🎨 UI可视化图详解

### 用户界面架构

#### 1. 主应用结构
- **全局状态管理**: QueryClientProvider、AuthProvider、TooltipProvider
- **路由系统**: Wouter路由、路由守卫、角色验证
- **布局组件**: 顶部导航、侧边栏、面包屑导航

#### 2. 角色仪表板设计

##### 管理员仪表板 (1440x900px)
- **侧边栏导航** (240px): 用户管理、组管理、系统设置、统计报告
- **主内容区** (1200px): 页面标题、统计卡片、数据表格、分页控件
- **统计卡片**: 总用户数、活跃会话、存储使用、系统状态
- **操作功能**: 用户CRUD、组管理、权限配置

##### 协调员仪表板
- **文档管理区域**: 文档列表、上传按钮、预览功能、版本控制
- **发布管理**: 发布计划表、创建发布、状态指示器
- **活动监控**: 用户活动日志、性能监控、错误日志查看

##### 教师仪表板
- **场景控制面板** (100px高): 场景选择器、开始/暂停、时间显示、学生在线数
- **学生监控面板** (400px宽): 学生列表、状态指示器、活动日志
- **患者信息面板** (1040px宽): 基本信息、生命体征图表、最新记录摘要

##### 学生仪表板
- **患者信息面板** (200px高): 患者头部信息、快速操作按钮
- **数据查看面板** (480px宽): 生命体征、实验室结果、医疗历史、用药记录
- **记录编写面板** (960px宽): SOAP笔记、医嘱下达、护理记录

#### 3. 共享UI组件系统

##### 患者相关组件
- **PatientList**: 患者列表展示、搜索过滤、选择操作
- **PatientOverview**: 患者概览信息、状态监控、数据摘要
- **PatientHeader**: 患者头部信息、基本资料、快速访问

##### 表单组件
- **SOAPNotesForm**: SOAP笔记编辑器、分段输入、实时保存
- **OrdersForm**: 医嘱表单、模板选择、验证提示
- **输入组件**: 文本框、文本区域、选择器、复选框

##### 反馈组件
- **NotificationToast**: 操作反馈、错误提示、成功确认
- **LoadingIndicator**: 加载状态、进度条、骨架屏
- **ErrorBoundary**: 错误捕获、友好提示、恢复操作

#### 4. shadcn/ui基础组件库

##### 输入组件
- **Button**: 多种样式、大小、状态变化
- **Input**: 文本输入、验证状态、前后缀图标
- **Select**: 下拉选择、搜索功能、多选支持

##### 布局组件
- **Card**: 信息卡片、标题描述、操作按钮
- **Dialog**: 对话框、确认弹窗、表单对话框
- **Tabs**: 选项卡、内容切换、响应式适配

### UI交互流程设计

#### 1. 认证流程
1. **访问应用** → 检查认证状态
2. **输入登录信息** → 用户名密码验证
3. **身份验证** → 角色权限检查
4. **跳转仪表板** → 基于角色的界面

#### 2. 管理员操作流程
1. **查看系统统计** → 用户活动监控
2. **管理用户账户** → CRUD操作、权限配置
3. **管理学习组** → 组创建、成员分配
4. **系统配置** → 参数设置、安全配置

#### 3. 教师操作流程
1. **选择教学场景** → 场景配置、参数设置
2. **启动仿真会话** → 学生分配、状态监控
3. **控制场景进度** → 时间控制、状态调整
4. **监控学生活动** → 实时反馈、进度跟踪

#### 4. 学生操作流程
1. **查看患者信息** → 基本资料、医疗历史
2. **分析数据** → 生命体征、实验室结果
3. **编写记录** → SOAP笔记、医嘱下达
4. **提交作业** → 保存草稿、最终提交

### UI组件关系结构

#### 1. 继承关系
- **DashboardBase** → AdminDashboard, CoordinatorDashboard, InstructorDashboard, StudentDashboard
- **FeatureComponentBase** → PatientList, SOAPNotesForm, OrdersForm
- **UIComponent** → Button, Input, Card, Dialog

#### 2. 组合关系
- **App** → QueryClientProvider + AuthProvider + AppRouter
- **Dashboard** → TopNavigation + Sidebar + MainContent
- **Form** → Input + Button + Validation

#### 3. 依赖关系
- **Form组件** → usePatient Hook → Patient数据
- **Navigation** → useAuth Hook → 用户状态
- **Dashboard** → QueryClient → API数据

### 响应式设计特点

#### 桌面端 (1440px+)
- 完整侧边栏导航
- 多列布局设计
- 丰富的交互元素
- 详细的数据展示

#### 平板端 (768px-1439px)
- 可折叠侧边栏
- 两列布局适配
- 触控优化交互
- 适中的信息密度

#### 移动端 (375px-767px)
- 汉堡菜单导航
- 单列垂直布局
- 选项卡式内容切换
- 大按钮触控设计

---

## 🎯 MVP核心功能

### 功能特性

#### 1. 用户管理系统
- 四角色权限控制
- 用户认证和授权
- 个人资料管理
- 密码安全策略

#### 2. 患者数据管理
- 患者信息录入
- 生命体征监控
- 实验室结果管理
- 医疗历史记录

#### 3. 临床记录系统
- SOAP笔记编写
- 医嘱下达管理
- 护理记录系统
- 评估记录管理

#### 4. 组级数据隔离
- 多组并行教学
- 数据版本控制
- 权限边界管理
- 审计日志追踪

#### 5. 文档管理系统
- 医疗文档上传
- 版本控制管理
- 发布调度控制
- 访问权限管理

### 技术特点

#### 1. 全栈TypeScript
- 类型安全保证
- 前后端代码共享
- 编译时错误检测
- 智能代码补全

#### 2. 现代化前端
- React 18并发特性
- 组件化架构设计
- 响应式用户界面
- 可访问性支持

#### 3. 高性能后端
- Node.js事件驱动
- Express中间件架构
- 异步处理支持
- 实时通信能力

#### 4. 可靠数据存储
- PostgreSQL ACID事务
- Drizzle ORM类型安全
- 数据完整性保证
- 高性能查询优化

---

## 📊 架构优势

### 技术优势

1. **类型安全**: 全栈TypeScript确保代码质量
2. **性能优秀**: React 18并发特性和Node.js高性能
3. **可扩展性**: 微服务架构支持水平扩展
4. **安全性**: 多层安全防护和权限控制
5. **可维护性**: 清晰的架构分层和组件设计

### 业务优势

1. **医疗专业性**: 符合医疗教育标准的专业系统
2. **数据安全**: 完整的医疗数据保护机制
3. **教学支持**: 支持多种教学场景和评估方式
4. **协作能力**: 支持团队协作和实时交互
5. **合规性**: 符合医疗教育相关法规要求

---

## 🔗 相关文档

- [风险评估报告](./risk-assessment.md)
- [风险缓解行动计划](./risk-mitigation-action-plan.md)
- [技术选择理由](./technology-choice-justification.md)
- [技能差距分析](./skills-gap-analysis.md)

---

## 📞 技术支持

如需查看架构图的详细内容或有技术问题，请参考：

1. **PlantUML在线编辑器**: 将.puml文件内容复制到在线编辑器中查看
2. **本地PlantUML**: 安装PlantUML插件到VS Code等编辑器
3. **架构设计讨论**: 联系技术架构团队进行详细讨论

---

**文档版本**: v1.0  
**最后更新**: 2025年1月  
**审核状态**: 待审核  
**下次更新**: 2025年2月

@startuml MediSimv1-UI-Interaction-Flow
!theme plain
skinparam backgroundColor #FFFFFF

title MediSimv1 用户界面交互流程图

' 定义样式
skinparam actor {
    BackgroundColor #E8F5E8
    BorderColor #388E3C
    FontColor #1B5E20
}

skinparam usecase {
    BackgroundColor #E3F2FD
    BorderColor #1976D2
    FontColor #0D47A1
}

skinparam rectangle {
    BackgroundColor #FFF3E0
    BorderColor #F57C00
    FontColor #E65100
}

' 用户角色定义
actor "系统管理员" as Admin
actor "仿真协调员" as Coordinator  
actor "教师" as Instructor
actor "学生" as Student

' 登录和认证流程
package "认证流程" {
    usecase "访问应用" as AccessApp
    usecase "输入登录信息" as EnterLogin
    usecase "验证身份" as ValidateAuth
    usecase "选择角色仪表板" as SelectDashboard
    
    rectangle "登录界面组件" as LoginComponents {
        usecase "用户名输入框" as UsernameInput
        usecase "密码输入框" as PasswordInput
        usecase "登录按钮" as LoginButton
        usecase "记住我选项" as RememberMe
        usecase "错误提示" as ErrorDisplay
    }
}

' 管理员操作流程
package "管理员操作流程" {
    usecase "查看系统统计" as ViewSystemStats
    usecase "管理用户账户" as ManageUsers
    usecase "创建新用户" as CreateUser
    usecase "编辑用户信息" as EditUser
    usecase "管理学习组" as ManageGroups
    usecase "创建学习组" as CreateGroup
    usecase "分配组成员" as AssignMembers
    usecase "系统配置" as SystemConfig
    
    rectangle "管理员界面组件" as AdminComponents {
        usecase "用户列表表格" as UserTable
        usecase "搜索过滤器" as SearchFilter
        usecase "添加用户对话框" as AddUserDialog
        usecase "编辑用户表单" as EditUserForm
        usecase "组管理卡片" as GroupCards
        usecase "统计图表" as StatsCharts
    }
}

' 协调员操作流程
package "协调员操作流程" {
    usecase "管理医疗文档" as ManageDocuments
    usecase "上传新文档" as UploadDocument
    usecase "版本控制" as VersionControl
    usecase "发布计划管理" as ManageReleases
    usecase "创建发布计划" as CreateRelease
    usecase "监控系统活动" as MonitorActivity
    usecase "查看用户日志" as ViewUserLogs
    
    rectangle "协调员界面组件" as CoordinatorComponents {
        usecase "文档列表" as DocumentList
        usecase "文件上传器" as FileUploader
        usecase "版本历史" as VersionHistory
        usecase "发布计划表" as ReleaseSchedule
        usecase "活动监控面板" as ActivityPanel
        usecase "日志查看器" as LogViewer
    }
}

' 教师操作流程
package "教师操作流程" {
    usecase "选择教学场景" as SelectScenario
    usecase "启动仿真会话" as StartSimulation
    usecase "控制场景进度" as ControlScenario
    usecase "监控学生活动" as MonitorStudents
    usecase "查看学生记录" as ViewStudentRecords
    usecase "调整患者状态" as AdjustPatientStatus
    usecase "提供实时反馈" as ProvideFeedback
    usecase "结束会话" as EndSession
    
    rectangle "教师界面组件" as InstructorComponents {
        usecase "场景选择器" as ScenarioSelector
        usecase "控制面板" as ControlPanel
        usecase "学生监控列表" as StudentMonitorList
        usecase "患者信息面板" as PatientInfoPanel
        usecase "实时消息系统" as RealtimeMessaging
        usecase "时间控制器" as TimeController
    }
}

' 学生操作流程
package "学生操作流程" {
    usecase "查看患者信息" as ViewPatientInfo
    usecase "分析生命体征" as AnalyzeVitals
    usecase "查看实验结果" as ViewLabResults
    usecase "编写SOAP笔记" as WriteSOAP
    usecase "下达医疗指令" as WriteMedicalOrders
    usecase "保存工作进度" as SaveProgress
    usecase "提交临床记录" as SubmitRecords
    usecase "接收教师反馈" as ReceiveFeedback
    
    rectangle "学生界面组件" as StudentComponents {
        usecase "患者信息卡片" as PatientCard
        usecase "数据查看选项卡" as DataTabs
        usecase "生命体征图表" as VitalChart
        usecase "SOAP编辑器" as SOAPEditor
        usecase "医嘱表单" as OrdersForm
        usecase "自动保存提示" as AutoSaveIndicator
        usecase "提交确认对话框" as SubmitDialog
    }
}

' 通用UI交互
package "通用UI交互" {
    usecase "响应式布局适配" as ResponsiveLayout
    usecase "暗色主题切换" as ThemeSwitch
    usecase "通知消息显示" as NotificationDisplay
    usecase "错误处理和恢复" as ErrorHandling
    usecase "键盘快捷键" as KeyboardShortcuts
    usecase "可访问性支持" as AccessibilitySupport
    
    rectangle "通用UI组件" as CommonUIComponents {
        usecase "顶部导航栏" as TopNavigation
        usecase "侧边栏菜单" as SidebarMenu
        usecase "面包屑导航" as BreadcrumbNav
        usecase "加载指示器" as LoadingSpinner
        usecase "确认对话框" as ConfirmDialog
        usecase "Toast通知" as ToastNotification
    }
}

' 数据流和状态管理
package "数据流和状态管理" {
    usecase "全局状态管理" as GlobalState
    usecase "用户认证状态" as AuthState
    usecase "实时数据同步" as RealtimeSync
    usecase "本地缓存管理" as LocalCache
    usecase "表单状态管理" as FormState
    usecase "路由状态管理" as RouteState
    
    rectangle "状态管理组件" as StateComponents {
        usecase "React Query缓存" as ReactQueryCache
        usecase "Context API状态" as ContextState
        usecase "LocalStorage持久化" as LocalStoragePersist
        usecase "会话状态同步" as SessionSync
    }
}

' 连接关系 - 认证流程
Admin --> AccessApp
Coordinator --> AccessApp
Instructor --> AccessApp
Student --> AccessApp

AccessApp --> EnterLogin
EnterLogin --> LoginComponents
LoginComponents --> ValidateAuth
ValidateAuth --> SelectDashboard

' 管理员流程连接
SelectDashboard --> ViewSystemStats : 管理员角色
ViewSystemStats --> AdminComponents
ManageUsers --> AdminComponents
ManageGroups --> AdminComponents
CreateUser --> AddUserDialog
EditUser --> EditUserForm

' 协调员流程连接
SelectDashboard --> ManageDocuments : 协调员角色
ManageDocuments --> CoordinatorComponents
UploadDocument --> FileUploader
ManageReleases --> ReleaseSchedule
MonitorActivity --> ActivityPanel

' 教师流程连接
SelectDashboard --> SelectScenario : 教师角色
SelectScenario --> InstructorComponents
StartSimulation --> ControlPanel
MonitorStudents --> StudentMonitorList
AdjustPatientStatus --> PatientInfoPanel

' 学生流程连接
SelectDashboard --> ViewPatientInfo : 学生角色
ViewPatientInfo --> StudentComponents
WriteSOAP --> SOAPEditor
WriteMedicalOrders --> OrdersForm
AnalyzeVitals --> VitalChart

' 通用UI连接
AdminComponents --> CommonUIComponents
CoordinatorComponents --> CommonUIComponents
InstructorComponents --> CommonUIComponents
StudentComponents --> CommonUIComponents

' 状态管理连接
LoginComponents --> StateComponents
AdminComponents --> StateComponents
CoordinatorComponents --> StateComponents
InstructorComponents --> StateComponents
StudentComponents --> StateComponents

' 交互流程注释
note right of AccessApp
  用户访问流程:
  1. 打开应用URL
  2. 检查认证状态
  3. 重定向到登录页面
  4. 或跳转到对应仪表板
end note

note right of SelectScenario
  教师场景控制:
  1. 选择预设教学场景
  2. 配置场景参数
  3. 分配学生到场景
  4. 启动仿真会话
  5. 实时监控和调整
end note

note right of WriteSOAP
  学生记录编写:
  1. 查看患者当前状态
  2. 分析收集的数据
  3. 按SOAP格式编写
  4. 实时保存草稿
  5. 提交完整记录
end note

note right of ManageUsers
  管理员用户管理:
  1. 查看用户列表
  2. 搜索和过滤用户
  3. 创建新用户账户
  4. 编辑用户信息
  5. 管理用户权限
end note

' UI设计原则注释
note top of ResponsiveLayout
  UI设计原则:
  ✅ 移动优先设计
  ✅ 可访问性标准
  ✅ 一致的视觉语言
  ✅ 直观的交互模式
  ✅ 快速响应反馈
end note

note bottom of StateComponents
  状态管理策略:
  ✅ 单向数据流
  ✅ 不可变状态更新
  ✅ 乐观UI更新
  ✅ 错误边界处理
  ✅ 持久化关键状态
end note

' 性能优化注释
note left of RealtimeSync
  性能优化措施:
  - 虚拟化长列表
  - 懒加载路由组件
  - 图片压缩和预加载
  - API请求去重和缓存
  - 防抖用户输入
end note

@enduml
